{% extends "layout.html" %}

{% block title %}{{ promise.description }} - Promise Tracker{% endblock %}

{% block content %}
<div class="promise-detail-container">
    <div class="breadcrumb">
        <a href="/promises">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤</a>
    </div>

    <div class="promise-header-card status-{{ promise.status.name.lower() }}">
        <div class="status-badge-large status-{{ promise.status.name.lower() }}">
            {{ promise.status.value }}
        </div>
        <h1>{{ promise.description }}</h1>
        <p class="announced-date">üìÖ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ promise.announced_date.strftime('%d/%m/%Y') }}</p>
    </div>

    <div class="content-grid">
        <div class="main-column">
            <section class="updates-section">
                <div class="section-header">
                    <h2>üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
                    {% if request.session.get("role") == "admin" and promise.status.value != "‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏´‡∏≤‡∏¢" %}
                    <a href="/promises/{{ promise.id }}/update" class="btn-primary">
                        ‚úèÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
                    </a>
                    {% endif %}
                </div>

                {% if promise.updates %}
                <div class="updates-timeline">
                    {% for update in promise.updates|sort(attribute='update_date', reverse=True) %}
                    <div class="update-card" style="animation: fadeInLeft 0.5s ease-out {{ loop.index0 * 0.1 }}s both;">
                        <div class="update-date">
                            üìÖ {{ update.update_date.strftime('%d/%m/%Y') }}
                        </div>
                        <div class="update-content">
                            <p>{{ update.detail }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p style="font-size: 1.1rem;">üí≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
                    <p style="font-size: 0.95rem; margin-top: 0.5rem; color: var(--neutral-400);">
                        ‡∏£‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ô‡∏µ‡πâ
                    </p>
                </div>
                {% endif %}
            </section>
        </div>

        <div class="sidebar-column">
            <section class="politician-card">
                <h3>üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤</h3>
                <div class="politician-info">
                    <div class="avatar-placeholder">
                        {{ promise.politician.name[0] }}
                    </div>
                    <div>
                        <h4><a href="/politicians/{{ promise.politician.id }}">{{ promise.politician.name }}</a></h4>
                        <p class="party">{{ promise.politician.party }}</p>
                    </div>
                </div>
            </section>

            <section class="campaign-card">
                <h3>üó≥Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
                <ul>
                    <li><strong>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á:</strong> {{ promise.campaign.year }}</li>
                    <li><strong>‡πÄ‡∏Ç‡∏ï:</strong> {{ promise.campaign.district }}</li>
                    <li><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏™‡∏±‡∏ç‡∏ç‡∏≤:</strong> #{{ promise.id }}</li>
                </ul>
            </section>

            <section class="campaign-card">
                <h3>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
                <ul>
                    <li><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:</strong> {{ promise.updates|length }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                    <li><strong>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> 
                        {% if promise.updates %}
                            {{ promise.updates|sort(attribute='update_date', reverse=True)|first|attr('update_date')|strftime('%d/%m/%Y') }}
                        {% else %}
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
                        {% endif %}
                    </li>
                </ul>
            </section>
        </div>
    </div>
</div>

<style>
    @keyframes fadeInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
</style>
{% endblock %}